<o:MethodTargetItem Id="98A9ACE6-BE1A-441F-83E4-E80B8916B0C5">
<a:ObjectID>98A9ACE6-BE1A-441F-83E4-E80B8916B0C5</a:ObjectID>
<a:Name>mdde_import_from_excel</a:Name>
<a:CreationDate>1736328921</a:CreationDate>
<a:Creator>BasBosman</a:Creator>
<a:Comment>Import example data from Excel</a:Comment>
<a:TargetCategory.Type>1</a:TargetCategory.Type>
<a:MethodScript>Sub %Method%(obj)
   &#39; Implement your method on &lt;obj&gt; here
     Dim x1
     Dim wb
     Dim activeWorksheet
     
     Dim actModel : Set actModel = ActiveModel
     Dim headerRows : headerRows = 2   
     &#39; Select a file
     Dim wShell : Set wShell=CreateObject(&quot;WScript.Shell&quot;)
     Dim oExec : Set oExec=wShell.Exec(&quot;mshta.exe &quot;&quot;about:&lt;input type=file id=FILE&gt;&lt;script&gt;FILE.click();new ActiveXObject(&#39;Scripting.FileSystemObject&#39;).GetStandardStream(1).WriteLine(FILE.value);close();resizeTo(0,0);&lt;/script&gt;&quot;&quot;&quot;)
     Dim sFileSelected : sFileSelected = oExec.StdOut.ReadLine
  
     Dim objCurrentExampleEntityData
     Dim exampleRecord
     Dim objCurrentExampleRec
     &#39;Delete current example records
     For Each objCurrentExampleEntityData In obj.getExtendedCollection(&quot;mdde_ExampleEntityData&quot;, False)
         For each objCurrentExampleRec in objCurrentExampleEntityData.getExtendedCollection(&quot;mdde_ExampleRecords&quot;, False)
            objCurrentExampleRec.Delete
            WriteInfo &quot;Delete old record &quot; &amp; objCurrentExampleRec.Code
         Next
     Next
      
      &#39; Open the Excel file
      WriteInfo &quot;Opening:&quot; &amp; sFileSelected
	   Set x1 = CreateObject(&quot;Excel.Application&quot;) 
	   x1.Visible = True 
      Set wb = x1.Workbooks.Open(sFileSelected)
   
     
     &#39;Add new example records
     Dim objWorksheet
        For Each objWorksheet In x1.Worksheets
        WriteInfo &quot;Processing worksheet &quot; &amp; objWorksheet.name
        &#39;Search for corresponding objExampleEntityData
        Dim objExampleEntityData : Set objExampleEntityData = nothing
        Dim objExampleEntityDataCheck
        Dim targetEntityType: targetEntityType = &quot;Expected output&quot;
        If left(objWorksheet.name, 3) = &quot;In-&quot; Then
            targetEntityType = &quot;Source input&quot; 
        End If
        
              
        For each objExampleEntityDataCheck in obj.getExtendedCollection(&quot;mdde_ExampleEntityData&quot;, False)
            Dim objEntity: set objEntity = objExampleEntityDataCheck.getExtendedAttribute(&quot;mdde_ExampleEntity&quot;)
            Dim entityType: entityType = objExampleEntityDataCheck.getExtendedAttribute(&quot;mdde_ExampleDataType&quot;)
            Set objEntity = getRealObject(objEntity)
            If objEntity.Code = objWorksheet.Cells(1,1) And entityType = targetEntityType Then
               Set objExampleEntityData = objExampleEntityDataCheck
               Exit for 
            End if
        Next
        If (objExampleEntityData is Nothing) then
            WriteInfo &quot;Entity &quot; &amp; objWorksheet.Cells(1,1) &amp; &quot; not found&quot;
            Exit for
        End if

        Dim recordCount : recordCount = 1 
        Dim nextRecord : nextRecord = true
        Dim totalAttributeCount : totalAttributeCount = 0
        
        Dim colExampleRec : Set colExampleRec = objExampleEntityData.GetExtendedCollection(&quot;mdde_ExampleRecords&quot;)
        Do while nextRecord
            &#39;Select next line
            Dim recordCode : recordCode = objWorksheet.Cells(recordCount + headerRows, 1)
            If recordCode &gt; &quot;&quot; then
               &#39;Create test record
               Dim objExampleRec : Set objExampleRec = colExampleRec.createNew()
               objExampleRec.Code = recordCode
               objExampleRec.Name = recordCode
               WriteInfo &quot;Created record: &quot; &amp; objExampleRec.Name
               
               &#39;Get all attributes for the example record
               Dim attributeCount : attributeCount = 1
               Dim nextAttribute : nextAttribute = true
               
               Dim colExampleAttribute : Set colExampleAttribute = objExampleRec.GetExtendedCollection(&quot;mdde_ExampleAttributeValues&quot;)
               
               Do while nextAttribute
                  &#39; Get attribute-code from header
                  Dim attributeCode : attributeCode = objWorksheet.Cells(headerRows, attributeCount + 1)
                  Dim attributeValue : attributeValue = objWorksheet.Cells(recordCount + headerRows, attributeCount + 1)

                  
                  &#39; First record : count number of attributes
                  If recordCount = 1 then
                     If attributeCode &gt; &quot;&quot; then
                        &#39; Append attribute code to list with attributes
                        totalAttributeCount = attributeCount
                     Else
                        nextAttribute = false
                     End if
                  End if
                  
                  If nextAttribute then
                     &#39; write attribute here
                     Dim objExampleAttribute : Set objExampleAttribute = colExampleAttribute.createNew()
                     objExampleAttribute.Code = attributeCode
                     objExampleAttribute.Name = attributeCode
                     
                     &#39;search the actual attribute
                     Dim entityAttribute
                     For each entityAttribute in objEntity.attributes
                        If entityAttribute.Name = attributeCode then
                           Exit for
                        End if
                     Next
                     
                     objExampleAttribute.SetExtendedAttribute &quot;mdde_Attribute&quot;, entityAttribute
                     objExampleAttribute.SetExtendedAttribute &quot;mdde_Value&quot;, attributeValue
                     WriteInfo &quot;Created attribute: &quot; &amp; attributeCode &amp; &quot; - &quot; &amp; attributeValue
                  End if
                  
                  &#39; Subsequent records: check if we added all attributes
                  If (recordCount &gt; 1 and (attributeCount = totalAttributeCount)) then
                     nextAttribute = false
                  End if
                  attributeCount = attributeCount + 1
               Loop
               
               attributeCount = attributeCount + 1
            Else
               nextRecord = false
            End if
            
            &#39; Select next row in Excel
            recordCount = recordCount + 1      
        Loop
     Next
     
     x1.Workbooks.Close
End Sub</a:MethodScript>
</o:MethodTargetItem>